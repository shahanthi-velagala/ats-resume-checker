<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Resume ATS Checker - Smart ATS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: { brand: { 50: '#f0f9ff', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1' } }
                }
            }
        }
    </script>
    <style>
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #0ea5e9;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen flex flex-col font-sans">

    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
            <div class="flex items-center text-brand-600 font-bold text-xl">
                <i class="fa-solid fa-layer-group mr-2"></i> AI Resume ATS Checker
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-8">
        <div class="mb-8 text-center sm:text-left">
            <h1 class="text-3xl font-bold text-gray-900">Resume Analysis</h1>
            <p class="text-gray-600">Upload your PDF and JD to see how you rank.</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Inputs -->
            <div class="lg:col-span-5 space-y-6">
                <div class="bg-white rounded-xl shadow-sm border p-6">
                    <label class="block text-sm font-semibold mb-2">Job Description</label>
                    <textarea id="jobDescription" rows="6" class="w-full rounded-lg border p-3 text-sm focus:ring-2 focus:ring-brand-500 outline-none" placeholder="Paste Job Description here..."></textarea>
                    <button onclick="fillSampleJD()" class="text-xs text-brand-600 mt-2 font-medium">Use Sample JD</button>
                </div>

                <div class="bg-white rounded-xl shadow-sm border p-6 text-center">
                    <label class="block text-sm font-semibold mb-2 text-left">Resume (PDF)</label>
                    <div id="dropZone" class="border-2 border-dashed rounded-lg p-8 cursor-pointer hover:bg-brand-50 transition-all relative">
                        <input type="file" id="resumeUpload" accept=".pdf" class="absolute inset-0 opacity-0 cursor-pointer">
                        <i class="fa-solid fa-cloud-arrow-up text-2xl text-gray-400 mb-2"></i>
                        <p id="fileName" class="text-sm text-gray-600">Click to upload resume</p>
                    </div>
                    <div id="fileStatus" class="hidden mt-2 p-2 bg-green-50 text-green-700 text-sm rounded flex justify-between items-center">
                        <span id="uploadedFileName" class="truncate"></span>
                        <button onclick="resetFile()"><i class="fa-solid fa-times"></i></button>
                    </div>
                </div>

                <button id="analyzeBtn" onclick="analyzeResume()" class="w-full bg-brand-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-brand-700 transition-all">
                    Analyze Match <i class="fa-solid fa-wand-magic-sparkles ml-2"></i>
                </button>
            </div>

            <!-- Results -->
            <div class="lg:col-span-7">
                <div id="emptyState" class="bg-white rounded-xl border border-dashed h-full min-h-[400px] flex flex-col items-center justify-center p-8">
                    <i class="fa-solid fa-chart-line text-4xl text-gray-200 mb-4"></i>
                    <p class="text-gray-500">Results will appear here after analysis.</p>
                </div>

                <div id="loadingState" class="hidden bg-white rounded-xl border h-full min-h-[400px] flex flex-col items-center justify-center p-8">
                    <div class="loader mb-4"></div>
                    <p class="font-semibold text-gray-800">Gemini is analyzing your resume...</p>
                </div>

                <div id="resultsDashboard" class="hidden space-y-6">
                    <div class="bg-white rounded-xl shadow-sm border p-6 flex items-center gap-6">
                        <div class="w-24 h-24 rounded-full border-8 border-brand-500 flex items-center justify-center text-xl font-bold" id="scoreValue">0%</div>
                        <div>
                            <h3 class="font-bold text-xl">Match Score</h3>
                            <p id="matchSummary" class="text-sm text-gray-600 mt-1"></p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white border rounded-xl p-4">
                            <h4 class="text-xs font-bold uppercase text-green-600 mb-2">Matching Skills</h4>
                            <div id="matchingSkillsList" class="flex flex-wrap gap-1"></div>
                        </div>
                        <div class="bg-white border rounded-xl p-4">
                            <h4 class="text-xs font-bold uppercase text-red-600 mb-2">Missing Skills</h4>
                            <div id="missingSkillsList" class="flex flex-wrap gap-1"></div>
                        </div>
                    </div>

                    <div class="bg-white border rounded-xl p-4">
                        <h4 class="font-bold mb-2">Suggestions</h4>
                        <ul id="suggestionList" class="text-sm text-gray-600 space-y-2 list-disc pl-4"></ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const fileInput = document.getElementById('resumeUpload');
        const fileNameDisplay = document.getElementById('fileName');
        const fileStatus = document.getElementById('fileStatus');
        const uploadedFileName = document.getElementById('uploadedFileName');
        const dropZone = document.getElementById('dropZone');

        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) {
                uploadedFileName.textContent = e.target.files[0].name;
                fileStatus.classList.remove('hidden');
                dropZone.classList.add('hidden');
            }
        });

        function resetFile() {
            fileInput.value = "";
            fileStatus.classList.add('hidden');
            dropZone.classList.remove('hidden');
        }

        function fillSampleJD() {
            document.getElementById('jobDescription').value = "We are looking for a Python Backend Developer with experience in Flask, REST APIs, and AWS. Knowledge of SQL and Docker is a plus.";
        }

        async function analyzeResume() {
            const jd = document.getElementById('jobDescription').value;
            const file = fileInput.files[0];

            if (!jd || !file) {
                alert("Please provide both a Job Description and a Resume PDF.");
                return;
            }

            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('resultsDashboard').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');

            const formData = new FormData();
            formData.append('job_description', jd);
            formData.append('resume', file);

            try {
                // CALLING YOUR LOCAL FLASK BACKEND
                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (data.error) throw new Error(data.error);

                renderResults(data);
            } catch (err) {
                alert("Error: " + err.message);
                document.getElementById('emptyState').classList.remove('hidden');
            } finally {
                document.getElementById('loadingState').classList.add('hidden');
            }
        }

        function renderResults(data) {
            document.getElementById('resultsDashboard').classList.remove('hidden');
            document.getElementById('scoreValue').textContent = data.match_percentage + "%";
            document.getElementById('matchSummary').textContent = data.match_summary;
            
            document.getElementById('matchingSkillsList').innerHTML = data.matching_skills.map(s => 
                `<span class="bg-green-100 text-green-700 px-2 py-1 rounded text-xs">${s}</span>`
            ).join('');
            
            document.getElementById('missing_skills' in data ? 'missingSkillsList' : 'missingSkillsList').innerHTML = (data.missing_skills || []).map(s => 
                `<span class="bg-red-100 text-red-700 px-2 py-1 rounded text-xs">${s}</span>`
            ).join('');

            document.getElementById('suggestionList').innerHTML = (data.improvement_suggestions || []).map(s => 
                `<li>${s}</li>`
            ).join('');
        }
    </script>
</body>
</html>